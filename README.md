# Система принятия ставок на события

## Содержание

1. [Стек технологий](#стек-технологий)
2. [Назначение проекта](#назначение-проекта)
3. [Основная информация по использованию API](#основная-информация-по-использованию-api)
4. [Установка и запуск](#установка-и-запуск)
5. [Автор](#автор)

## Стек технологий

- **Python**: 3.12
- **FastAPI**: 0.115.7
- **Elastic Search**: 8.10.1
- **База данных**: postgis:17-3.4-alpine(PostgreSQL со встроенными методами работы с геоданными)

## Назначение проекта

Справочник организаций — это REST API, предназначенное для управления информацией об организациях,
их зданиях и видах деятельности.
Основные функции сервиса:

**Управление организациями**: создание, обновление, удаление и поиск организаций по различным критериям, таким как
название, вид деятельности или местоположение.

**Здания**: каждая организация должна быть привязана к конкретному зданию.
Сервис позволяет управлять зданиями и их данными, включая адрес и географические координаты (широту и долготу).

**Виды деятельности**: поддержка классификации организаций по видам деятельности.
Система позволяет работать с древовидной структурой деятельности, ограничивая уровень вложенности до трёх уровней.

В качестве базы данных для сервиса используется PostgreSQL с встроенными расширениями для работы с геоданными.

**Ради упрощения системы в проекте не было подключено кэширование данных.**

## Основная информация по использованию API

В системе предусмотрен статический токен для обращения к эндпоинтам, назначить его можно в файле **.env**.
Для взаимодействия с API перейдите на страницу документации: http://localhost:8000/docs

Первым запросом нужно загрузить начальные данные в БД, для этого реализован эндпоинт:
POST /load-initial-data
Ответ:

```json
{
  "message": "Данные загружены успешно."
}
```

### Основные эндпоинты реализованные по ТЗ:

**/api/organizations/get-by-building-id/{building_id}** - Получения списка организаций находящихся в здании.

**/api/organizations/get-by-activity-id/{activity_id}** - Получения списка организаций связанных с конкретным видом
деятельности.

**/api/buildings/get-in_radius** - Получения списка зданий(с организациями принадлежащими в этому зданию) в радиусе от
точки координаты которой переданы в запросе.

**/api/organizations/get-one/{organization_id}** - Получение организации со всеми связными объектами.

**/api/organizations/get-by-first-level-activities/{activity_id}** - Получения списка организаций принадлежащих в ветки
видов деятельности, передаются только id корневых элементов.

**/api/organizations/search_by_name** - Поиск организации по имени, реализован через Elastic Search.

Остальные эндпоинты реализованы для более удобного управления сущностями внутри БД.

## Установка и запуск

Клонировать репозиторий и перейти в него:

```
git clone https://github.com/Alex386386/organization_manager.git
cd organization_manager/
```

Создайте файл **.env** в корне проекта со следующим содержанием:

```
# Данные PostgreSQL
DB_ENGINE=postgresql+asyncpg
DB_NAME=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=qwertyytrewq
DB_HOST=manager_db
DB_PORT=5432
DATABASE_URL="postgresql+asyncpg://postgres:qwertyytrewq@manager_db:5432/postgres"

# Данные авторизации
LINE_PROVIDER_TOKEN="f3fb8928bad49887d2089f5ad04c2cb634bb1980db77fc8c3b111edad34f4eb7"

# Переменные для работы с картами
METER_COEFFICIENT=1000
WGS_STANDARD=4326

# Адрес подключения к Elastic Search
ES_ADDRESS="http://elasticsearch:9200"

# Уровень логирования в приложении
LOG_LEVEL="DEBUG"
```

Данные можно оставить без изменений или заменить на свои.

Запустить проект:

```
sudo docker compose up --build
```

Для наглядности работы системы уровень логирования установлен на DEBUG.
Так же для упрощения все логи записываются в поток исполнения.

## Автор

- [Александр Мамонов](https://github.com/Alex386386) 
